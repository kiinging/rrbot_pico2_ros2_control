<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Adafruit Servo Driver Library Pi Pico: Adafruit-Servo-Driver-Library-Pi-Pico</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Adafruit Servo Driver Library Pi Pico
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Adafruit-Servo-Driver-Library-Pi-Pico </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is both a port of Adafruit's Arduino library for the PCA9685 (<a href="https://github.com/adafruit/Adafruit-PWM-Servo-Driver-Library/tree/master#adafruit-pca9685-pwm-servo-driver-library-">Adafruit Library) for the Raspberry Pi Pico board and an improvement on the PCA9685 Servo Controller library for Pi Pico (PCA9685 Servo Controller</a>).</p>
<p>Please note it is not a Micropython library (as those have been released by Adafruit <a href="https://github.com/adafruit/Adafruit_CircuitPython_PCA9685">Circuitpython library</a>), but a library meant to be used with Pi Pico C/C++ SDK.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Setup</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
Include the headers</h2>
<p>Copy the repository into your project. Include two files in your main cpp file:</p><ul>
<li><code>#include &lt;<a class="el" href="PCA9685__servo__driver_8h_source.html">PCA9685_servo_driver.h</a>&gt;</code></li>
<li><code>#include &lt;<a class="el" href="PCA9685__servo_8h_source.html">PCA9685_servo.h</a>&gt;</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md3"></a>
Change your CMakeLists.txt</h2>
<p>Add the library executables: </p><pre class="fragment">add_executable(${PROJECT_NAME}
    main.cpp (your executable file)
    Adafruit-Servo-Driver-Library-Pi-Pico/PCA9685_servo_driver.cpp
    Adafruit-Servo-Driver-Library-Pi-Pico/PCA9685_servo.cpp
)
</pre><p> Then include the library directory: </p><pre class="fragment">target_include_directories(${PROJECT_NAME}
    PRIVATE Adafruit-Servo-Driver-Library-Pi-Pico
)
</pre><p> Lastly, if you haven't already, link the hardware_i2c library: </p><pre class="fragment">target_link_libraries(${PROJECT_NAME}
    hardware_i2c
)
</pre> <h2><a class="anchor" id="autotoc_md4"></a>
Create necessary objects</h2>
<ul>
<li>Create an object of <a class="el" href="classPCA9685__servo__driver.html">PCA9685_servo_driver</a> type to serve as your interface with the PCA9685 board. <code><a class="el" href="classPCA9685__servo__driver.html">PCA9685_servo_driver</a> myController(i2c0);</code></li>
<li>Create an object(s) (depending on the number of servos that are being driven) of <a class="el" href="classPCA9685__servo.html">PCA9685_servo</a> type to keep track of the servo's parameters and movement. <code>std::vector&lt;PCA9685_servo&gt; myServo = {<a class="el" href="classPCA9685__servo.html">PCA9685_servo(&amp;myController, 0, 100, 540)</a>};</code></li>
<li>Initialize the servo:<ul>
<li>set the angle range with <code>setRange()</code>,</li>
<li>set operation mode with <code>setMode()</code>,</li>
<li>set initial position with <code>setPosition()</code>,</li>
<li>set channel number on the board with <code>setAddress()</code>,</li>
<li>set duration of movement in constant time mode with <code>setTConstantDuration()</code>.</li>
</ul>
</li>
<li>In the main() loop, initialize the connection to the PCA9685 with <code>myController.begin();</code>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md5"></a>
Create control loop</h2>
<p>Create a loop in which <a class="el" href="classPCA9685__servo.html#a1826df3efdd53a86974109680cb7a886" title="Routine to call every loop iteration.">PCA9685_servo.loop()</a> method will be called for each of the controlled servos. Into the loop() method pass an argument with time elapsed since last loop iteration (to keep track of when to move the servo). </p><pre class="fragment">while(1)
{
    TEllapsed = TNow - TPrevious;
    for(auto&amp; servo : myServo) servo.loop(TEllapsed);
}
</pre> <h1><a class="anchor" id="autotoc_md6"></a>
How to control the servo</h1>
<h2><a class="anchor" id="autotoc_md7"></a>
Movement modes</h2>
<p>There are 3 modes:</p><ul>
<li><code>MODE_FAST</code> - moves to the set position immediately, with maximum speed (part of the <a class="el" href="classPCA9685__servo.html">PCA9685_servo</a> class as _TFastDuration),</li>
<li><code>MODE_TCONSTANT</code> - the movement takes exactly _TConstantDuration microseconds, independent of the length of the movement,</li>
<li><code>MODE_SCONSTANT</code> - the servo moves with a set angular velocity (set with setAngularVelocity()), which means the servo moves one degree after _SConstantPeriod microseconds.</li>
</ul>
<p>Select a mode with <code>setMode()</code> method.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Set servo position</h2>
<p>In order to move the servo, it first needs to get its position changed with <code>setPosition()</code> or <code>setRelativePosition()</code> methods. The argument passed is the position to move to in degrees. It takes effect immediately.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Set servo speed or movement time</h2>
<p>In order to change the speed, use the <code>setAngularVelocity()</code> method, providing velocity in deg/s. It changes the speed in both MODE_SCONSTANT and MODE_TCONSTANT modes.</p>
<p>In order to change the movement time, use <code>changeSpeedConstT()</code>.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Loop through the movement</h2>
<p>After setting the position, it is necessary to call the <code>loop()</code> method repeatedly in order to execute the movement. It needs an argument that counts the time between the last call to the <code>loop()</code> and now in microseconds.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Other functions</h1>
<h2><a class="anchor" id="autotoc_md12"></a>
Servo status</h2>
<p>Each servo keeps track of itself, it's possible to retrieve these states through e.g.:</p><ul>
<li><code>getPosition()</code> retrieves current position in degrees,</li>
<li><code>isMoving()</code> is the servo moving or not.</li>
</ul>
<h2><a class="anchor" id="autotoc_md13"></a>
Callbacks</h2>
<p>Each servo can call a function on start or end of movement through binding to function pointer. E.g. </p><pre class="fragment">void StopMoveHandler(uint16_t Address) { INTERNAL_LED(0); }
servo.onStopMove = StopMoveHandler;
</pre> <h1><a class="anchor" id="autotoc_md14"></a>
PWM Pulse length count</h1>
<p>In order to properly control the servo, its PWM pulse length count has to be determined. The usual range lies within (100-600), but please find the one matching your particular servo. The best way to do this is by manually changing the lower and upper range by a little bit until it matches the (-90, 90) degree range.</p>
<h2><a class="anchor" id="autotoc_md15"></a>
Examples</h2>
<p>A simple example can be found in the <code>examples</code> directory alongside a sample CMakeLists.txt file.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
Problems and bugs</h2>
<p>At the moment there are not any known problems or bugs, please feel free to report them. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
